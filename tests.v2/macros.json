{
  "macro_bootstrap_admin": [
    {
      "name": "Macro: Bootstrap Admin",
      "command": "auth.login",
      "data": { "username": "Federation Administrator", "passwd": "BOT" },
      "user": "admin",
      "save": { "session": "data.session", "admin_player_id": "data.player_id" },
      "stop_on_fail": true
    }
  ],
  "macro_auth_user": [
    {
      "setup": "macro_bootstrap_admin"
    },
    {
      "name": "Macro: Register User",
      "command": "auth.register",
      "data": { "username": "@username", "passwd": "@password" },
      "register_if_missing": true
    },
    {
      "command": "auth.login",
      "data": { "username": "@username", "passwd": "@password" },
      "user": "@username",
      "save": { "session": "data.session" },
      "stop_on_fail": true
    }
  ],
  "macro_sysop": [
    {
      "setup": "macro_auth_user",
      "username": "@username",
      "password": "@password"
    },
    {
      "name": "Macro: Promote Sysop",
      "command": "sys.raw_sql_exec",
      "data": { "sql": "UPDATE players SET type = 1 WHERE name = '@username';" },
      "user": "admin",
      "expect": { "status": "ok" },
      "stop_on_fail": true
    }
  ],
    "macro_fund_player": [
      {
        "name": "Macro: Fund Player (Petty)",
        "command": "sys.raw_sql_exec",
        "data": { "sql": "UPDATE players SET credits = @amount WHERE name = '@username';" },
        "user": "admin"
      },
      {
        "name": "Macro: Fund Player (Bank)",
        "command": "sys.raw_sql_exec",
        "data": { "sql": "INSERT INTO bank_accounts (owner_type, owner_id, balance, currency, is_active) SELECT 'player', id, @amount, 'CRD', 1 FROM players WHERE name = '@username' ON CONFLICT (owner_type, owner_id, currency) DO UPDATE SET balance = @amount;" },
        "user": "admin"
      }
    ],
    "macro_rich_user": [
      {
        "setup": "macro_auth_user",
        "username": "@username",
        "password": "@password"
      },
      {
        "setup": "macro_fund_player",
        "username": "@username",
        "amount": 1000000
      }
    ],
    "macro_user_in_sector": [
      {
        "setup": "macro_auth_user",
        "username": "@username",
        "password": "@password"
      },
      {
        "name": "Macro: Create Ship for User",
        "command": "sys.raw_sql_exec",
        "data": { "sql": "INSERT INTO ships (type_id, name, holds, sector, ported) SELECT 1, 'TestShip', 100, 1, 0 FROM players WHERE name = '@username' ON CONFLICT DO NOTHING;" },
        "user": "admin",
        "expect": { "status": "ok" }
      },
      {
        "name": "Macro: Assign Ship to User",
        "command": "sys.raw_sql_exec",
        "data": { "sql": "UPDATE players SET sector = 1 WHERE name = '@username';" },
        "user": "admin",
        "expect": { "status": "ok" },
        "stop_on_fail": true
      }
    ]
}
