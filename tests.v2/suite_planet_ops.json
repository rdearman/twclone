{
  "test_suite_name": "Planet Operations",
  "description": "Validates planet renaming and ownership transfer mechanics",
  "tests": [
    {
      "name": "Setup: Auth Lord",
      "setup": "macro_auth_user",
      "user": "planet_lord",
      "passwd": "password"
    },
    {
      "name": "Setup: Auth Heir",
      "setup": "macro_auth_user",
      "user": "planet_heir",
      "passwd": "password"
    },
    {
      "name": "Setup: Create Planet",
      "command": "sys.raw_sql_exec",
      "user": "admin",
      "data": {
        "sql": "INSERT OR REPLACE INTO planets (id, sector, name, owner_id, owner_type, created_by, created_at) VALUES (200, 1, 'Dune', @planet_lord_player_id, 'player', @planet_lord_player_id, strftime('%s','now'));"
      },
      "expect": { "status": "ok" }
    },
    {
      "name": "Planet: Rename (Success)",
      "command": "planet.rename",
      "user": "planet_lord",
      "data": {
        "planet_id": 200,
        "new_name": "Arrakis"
      },
      "expect": {
        "status": "planet.rename.success"
      }
    },
    {
      "name": "Verify: Name Change",
      "command": "sys.raw_sql_exec",
      "user": "admin",
      "data": {
        "sql": "SELECT name FROM planets WHERE id = 200;"
      },
      "expect": {
        "rows": [ [ "Arrakis" ] ]
      }
    },
    {
      "name": "Planet: Rename (Fail - Not Owner)",
      "command": "planet.rename",
      "user": "planet_heir",
      "data": {
        "planet_id": 200,
        "new_name": "Geidi Prime"
      },
      "expect": {
        "error_code": 708,
        "message": "You do not own this planet."
      }
    },
    {
      "name": "Planet: Transfer Ownership",
      "command": "planet.transfer_ownership",
      "user": "planet_lord",
      "data": {
        "planet_id": 200,
        "target_id": "@planet_heir_player_id",
        "target_type": "player"
      },
      "expect": {
        "status": "planet.transfer.success"
      }
    },
    {
      "name": "Verify: Owner Change",
      "command": "sys.raw_sql_exec",
      "user": "admin",
      "data": {
        "sql": "SELECT owner_id FROM planets WHERE id = 200;"
      },
      "expect": {
        "rows": [ [ "@planet_heir_player_id" ] ]
      }
    },
    {
      "name": "Planet: Rename (Fail - Old Owner)",
      "command": "planet.rename",
      "user": "planet_lord",
      "data": {
        "planet_id": 200,
        "new_name": "Caladan"
      },
      "expect": {
        "error_code": 708
      }
    }
  ]
}