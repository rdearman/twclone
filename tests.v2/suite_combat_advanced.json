{
  "name": "Combat Advanced Regression",
  "version": "2.0.0",
  "protocol_category": "23_Combat",
  "description": "Coverage for advanced combat mechanics",
  "tests": [
    {
      "name": "Setup: User in Ship",
      "setup": "macro_auth_user",
      "username": "combat_ace",
      "password": "password"
    },
    {
      "name": "Combat Status",
      "command": "combat.status",
      "user": "combat_ace",
      "expect": { "status": "ok" }
    },
    {
      "name": "Deploy Fighters",
      "command": "combat.deploy_fighters",
      "data": { "amount": 10, "offense": 3 },
      "user": "combat_ace",
      "expect": { "status": "ok" },
      "save": { "fighter_asset_id": "data.asset_id" }
    },
    {
      "name": "List Deployed Fighters (Verify Deploy)",
      "command": "deploy.fighters.list",
      "data": { "sector_id": 1 },
      "user": "combat_ace",
      "expect": { "status": "ok" },
      "asserts": [
        { "path": "data.entries.0.count", "op": "==", "value": 10 }
      ]
    },
    {
      "name": "Recall Fighters",
      "command": "fighters.recall",
      "data": { "sector_id": 1, "asset_id": "@fighter_asset_id" },
      "user": "combat_ace",
      "expect": { "status": "ok" }
    },
    {
      "name": "List Deployed Fighters (Verify Recall)",
      "command": "deploy.fighters.list",
      "data": { "sector_id": 1 },
      "user": "combat_ace",
      "expect": { "status": "ok" },
      "asserts": [
        { "path": "data.total", "op": "==", "value": 0 }
      ]
    },
    {
      "name": "Deploy Mines",
      "command": "combat.deploy_mines",
      "data": { "amount": 5, "type": "armid" },
      "user": "combat_ace",
      "expect": { "status": "ok" },
      "save": { "mine_asset_id": "data.asset_id" }
    },
    {
      "name": "List Deployed Mines (Verify Deploy)",
      "command": "deploy.mines.list",
      "data": { "sector_id": 1 },
      "user": "combat_ace",
      "expect": { "status": "ok" },
      "asserts": [
        { "path": "data.entries.0.count", "op": "==", "value": 5 }
      ]
    },
    {
      "name": "Recall Mines",
      "command": "mines.recall",
      "data": { "sector_id": 1, "asset_id": "@mine_asset_id" },
      "user": "combat_ace",
      "expect": { "status": "ok" }
    },
    {
      "name": "List Deployed Mines (Verify Recall)",
      "command": "deploy.mines.list",
      "data": { "sector_id": 1 },
      "user": "combat_ace",
      "expect": { "status": "ok" },
      "asserts": [
        { "path": "data.total", "op": "==", "value": 0 }
      ]
    },
    {
      "name": "Attack Planet",
      "command": "combat.attack_planet",
      "data": { "planet_id": 900 },
      "user": "combat_ace",
      "expect": { "status": "ok" }
    },
    {
      "name": "Port Rob (Success)",
      "command": "port.rob",
      "data": { "sector_id": 1, "port_id": 1, "mode": "credits" },
      "user": "combat_ace",
      "expect": { "status": "ok" }
    }
  ]
}
