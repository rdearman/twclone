{
  "name": "Movement & Navigation Regression",
  "version": "2.0.0",
  "protocol_category": "15_Navigation",
  "description": "Coverage for sector info, scanning, bookmarks, avoids",
  "tests": [
    {
      "name": "Setup: User",
      "setup": "macro_auth_user",
      "username": "nav_user",
      "password": "password"
    },
    {
      "name": "Rig: Create Warp Links",
      "command": "sys.raw_sql_exec",
      "user": "admin",
      "data": {
        "sql": "INSERT INTO sector_warps (from_sector, to_sector) VALUES (1, 1646), (1646, 1) ON CONFLICT DO NOTHING;"
      },
      "expect": { "status": "ok" }
    },
    {
      "name": "Rig: Position nav_user player at Sector 1",
      "command": "sys.raw_sql_exec",
      "user": "admin",
      "data": {
        "sql": "UPDATE players SET sector_id = 1 WHERE name = 'nav_user';"
      },
      "expect": { "status": "ok" }
    },
    {
      "name": "Rig: Position nav_user ship at Sector 1",
      "command": "sys.raw_sql_exec",
      "user": "admin",
      "data": {
        "sql": "UPDATE ships SET sector_id = 1 WHERE ship_id = (SELECT ship_id FROM players WHERE name = 'nav_user');"
      },
      "expect": { "status": "ok" }
    },
    {
      "name": "Sector Info",
      "command": "sector.info",
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Move Describe Sector",
      "command": "move.describe_sector",
      "data": { "sector_id": 1 },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Move Scan",
      "command": "move.scan",
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Sector Scan Density",
      "command": "sector.scan.density",
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Move to Sector 1646",
      "command": "move.warp",
      "data": { "to_sector_id": 1646 },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Sector Set Beacon",
      "command": "sector.set_beacon",
      "data": { "sector_id": 1646, "text": "Hello World" },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Nav Bookmark Add",
      "command": "nav.bookmark.add",
      "data": { "name": "Home", "sector_id": 1 },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Nav Bookmark List",
      "command": "nav.bookmark.list",
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Nav Bookmark Remove",
      "command": "nav.bookmark.remove",
      "data": { "name": "Home" },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Nav Avoid Add",
      "command": "nav.avoid.add",
      "data": { "sector_id": 666 },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Nav Avoid List",
      "command": "nav.avoid.list",
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Nav Avoid Remove",
      "command": "nav.avoid.remove",
      "data": { "sector_id": 666 },
      "user": "nav_user",
      "expect": { "status": "ok" }
    },
    {
      "name": "Move Transwarp (Fail - No Equipment)",
      "command": "move.transwarp",
      "data": { "sector_id": 2 },
      "user": "nav_user",
      "expect": { "error_code": 1458 }
    }
  ]
}