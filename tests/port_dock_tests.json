{
  "tests": [
    {
      "name": "Register and Login",
      "cmd": "auth.register",
      "register_if_missing": true,
      "data": {
        "username": "dock_tester",
        "passwd": "password123"
      },
      "expect": {
        "status": "ok"
      }
    },
    {
      "name": "Login",
      "cmd": "auth.login",
      "data": {
        "username": "dock_tester",
        "passwd": "password123"
      },
      "expect": {
        "status": "ok",
        "type": "auth.session"
      },
      "save": { "dock_tester_id": "data.player_id" }
    },
    {
      "name": "Ensure Player at Port",
      "cmd": "sys.raw_sql_exec",
      "data": {
        "sql": "UPDATE players SET sector = 1 WHERE name = 'dock_tester'; UPDATE ships SET sector = 1, ported = 0, onplanet = 0 WHERE id = (SELECT ship FROM players WHERE name = 'dock_tester');"
      },
      "expect": {
        "status": "ok"
      }
    },
    {
      "name": "Test: Successful Docking",
      "cmd": "port.dock",
      "expect": {
        "status": "ok",
        "type": "player.dock.v1",
        "data": {
            "player_id": "@dock_tester_id",
            "sector_id": 1,
            "port_id": 1
        }
      }
    },
    {
      "name": "Test: Undocking",
      "cmd": "dock.status",
      "data": { "action": "undock" },
      "expect": {
        "status": "ok",
        "data": {
            "docked": false
        }
      }
    },
    {
        "name": "Test: Docking Status",
        "cmd": "dock.status",
        "expect": {
            "status": "ok",
            "data": {
                "docked": false
            }
        }
    }
  ]
}
