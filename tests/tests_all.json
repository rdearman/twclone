{
  "tests": [
    {
      "name": "auth.login",
      "cmd": "auth.login",
      "data": {
        "user_name": "@user",
        "password": "@passwd"
      },
      "expect": {
        "status": "ok",
        "type": "auth.session",
        "data": {
          "player": "*object"
        }
      }
    },
      {
	  "name": "system.hello",
	  "cmd": "system.hello",
	  "expect": {
	      "id": "srv-ok",
	      "ts": "*",
	      "status": "ok",
	      "type": "session.hello",
	      "data": {
		  "protocol_version": "*",
		  "server_time_unix": "*",
		  "authenticated": true,
		  "player_id": "*",
		  "current_sector": "*",
		  "server_time": "*"
	      },
	      "error": null,
	      "meta": "*"
	  },
	  "capture": { "curSector": "data.current_sector" }
      },

      {
	  "name": "system.capabilities",
	  "cmd": "system.capabilities",
	  "expect": {
	      "id": "srv-ok",
	      "ts": "*",
	      "status": "ok",
	      "type": "system.capabilities",
	      "data": {
		  "protocol_version": "*",
		  "features": "*",
		  "schemas": "*array",
		  "command_count": "*",
		  "limits": "*"
	      },
	      "error": null,
	      "meta": "*"
	  }
      },
      {
	  "name": "system.describe_schema (system)",
	  "cmd": "system.describe_schema",
	  "data": { "name": "system" },
	  "expect": { "status": "ok", "type": "system.schema", "data": "*" }
      },
      {
	  "name": "player.my_info",
	  "cmd": "player.my_info",
	  "expect": {
	      "id": "srv-ok",
	      "ts": "*",
	      "status": "ok",
	      "type": "player.info",
	      "data": { "player": "*", "ship": "*" },
	      "error": null,
	      "meta": "*"
	  },
	  "capture": {
	      "my_id": "data.player.id",
	      "curSector": "data.ship.location.sector_id"
	  }
      },
      {
	  "name": "ship.info",
	  "cmd": "ship.info",
	  "expect": {
	      "id": "srv-ok",
	      "ts": "*",
	      "status": "ok",
              "type": "ship.status",
              "data": {
		  "ship": "*"
	      },
	      "error": null,
	      "meta": "*"

	  }
      },
      {
	  "name": "sector.info (current)",
	  "cmd": "move.describe_sector",
	  "data": { "sector_id": "@curSector" },
	  "expect": {
	      "id": "srv-ok",
	      "ts": "*",
	      "status": "ok",
	      "type": "sector.info",
	      "data": {
		  "sector_id": "*",
		  "ports": "*array"
	      },
	      "meta": "*"
	  },
	  "asserts": [
	      { "path": "data.sector_id", "op": ">", "value": 0 }
	  ],
	  "capture": {
	      "portId": "data.ports.0.id"
	  }
      },
      

{
  "name": "move.pathfind ok @curSector->10 (compat keys)",
  "cmd": "move.pathfind",
  "data": {
    "from": "@curSector",
    "from_sector_id": "@curSector",
    "to": 10,
    "to_sector_id": 10
  },
  "expect": {
    "status": "ok",
    "type": "move.path_v1",
    "data": "*",
    "meta": "*"
  }
}


      
    {
      "name": "move.warp refused: to current sector",
      "cmd": "move.warp",
      "data": {
        "from": "@curSector",
        "to_sector_id": "@curSector"
      },
      "expect": {
        "status": "refused",
        "error": {
          "code": "*any"
        }
      }
    },
    {
      "name": "move.autopilot.start (NIY)",
      "cmd": "move.autopilot.start",
      "data": {
        "to": 10
      },
      "expect": {
        "status": "error",
        "type": "error",
        "error": {
          "code": 1101
        }
      }
    },
    {
      "name": "move.autopilot.status (NIY)",
      "cmd": "move.autopilot.status",
      "expect": {
        "status": "error",
        "type": "error",
        "error": {
          "code": 1101
        }
      }
    },
    {
      "name": "move.autopilot.stop (NIY)",
      "cmd": "move.autopilot.stop",
      "expect": {
        "status": "error",
        "type": "error",
        "error": {
          "code": 1101
        }
      }
    },
    {
      "name": "sector.set_beacon",
      "cmd": "sector.set_beacon",
      "idempotency_key": "test-beacon-1762338651-2364",
      "data": {
        "sector": "@curSector",
        "title": "The Federation -- Do Not Dump!"
      },
      "expect": {
        "status": "ok",
        "type": "sector.info"
      }
    },
    {
      "name": "trade.port_info (by port_id)",
      "cmd": "trade.port_info",
      "data": {
        "port_id": "@portId"
      },
      "expect": {
        "status": "ok",
        "type": "trade.port_info",
        "data": "*object"
      }
    },
    {
      "name": "trade.buy ok (items list)",
      "cmd": "trade.buy",
      "idempotency_key": "test-buy-single-1762338651-2594",
      "data": {
        "port_id": "@portId",
        "items": [
          {
            "commodity": "ore",
            "quantity": 1
          }
        ]
      },
      "expect": {
        "status": "ok",
        "type": "trade.receipt"
      }
    },
    {
      "name": "trade.buy idempotent replay",
      "cmd": "trade.buy",
      "idempotency_key": "@prev_idempotency_key",
      "data": {
        "port_id": "@portId",
        "items": [
          {
            "commodity": "ore",
            "quantity": 1
          }
        ]
      },
      "expect": {
        "status": "ok",
        "type": "trade.receipt"
      }
    },
    {
      "name": "trade.sell refused invalid commodity",
      "cmd": "trade.sell",
      "idempotency_key": "test-sell-invalid-1762338651-4283",
      "data": {
        "port_id": "@portId",
        "items": [
          {
            "commodity": "invalid_thing",
            "quantity": 1
          }
        ]
      },
      "expect": {
        "status": "refused",
        "error": {
          "code": "*any"
        }
      }
    },
    {
      "name": "trade.history (no next_cursor required)",
      "cmd": "trade.history",
      "data": {
        "limit": 5
      },
      "expect": {
        "status": "ok",
        "type": "trade.history",
        "data": {
          "history": "*array"
        }
      }
    },
    {
      "name": "combat.deploy_fighters ok",
      "cmd": "combat.deploy_fighters",
      "idempotency_key": "test-fighters-deploy-1762338651-2237",
      "data": {
        "amount": 1,
        "offense": 2
      },
      "expect": {
        "status": "ok",
        "type": "combat.fighters.deployed"
      }
    },
    {
      "name": "deploy.fighters.list (current sector)",
      "cmd": "deploy.fighters.list",
      "data": {
        "sector_id": "@curSector"
      },
      "expect": {
        "status": "ok",
        "type": "Deploy.fighters.list_v1",
        "data": {
          "total": "*int"
        }
      }
    },
    {
      "name": "deploy.mines.list (current sector)",
      "cmd": "deploy.mines.list",
      "data": {
        "sector_id": "@curSector"
      },
      "expect": {
        "status": "ok",
        "type": "deploy.mines.list_v1",
        "data": {
          "total": "*int"
        }
      }
    },
    {
      "name": "notice.create (system)",
      "cmd": "sys.notice.create",
      "data": {
        "title": "Test notice",
        "body": "This is a test notice",
        "severity": "info"
      },
      "expect": {
        "status": "ok",
        "type": "announce.created",
        "data": {
          "id": "*any",
          "severity": "info"
        }
      }
    },
    {
      "name": "notice.list (no next_cursor required)",
      "cmd": "notice.list",
      "data": {
        "limit": 5
      },
      "expect": {
        "status": "ok",
        "type": "notice.list_v1",
        "data": {
          "items": "*array"
        }
      }
    },
    {
      "name": "mail.send",
      "cmd": "mail.send",
      "data": {
        "to": "@my_id",
        "subject": "Hello",
        "body": "Test"
      },
      "expect": {
        "status": "ok",
        "type": "mail.sent",
        "data": {
          "id": "*any"
        }
      }
    },
    {
      "name": "mail.inbox",
      "cmd": "mail.inbox",
      "data": {
        "limit": 5
      },
      "expect": {
        "status": "ok",
        "type": "mail.inbox_v1",
        "data": {
          "items": "*array"
        }
      }
    },
    {
      "name": "mail.delete (ids array)",
      "cmd": "mail.delete",
      "data": {
        "ids": [
          1
        ]
      },
      "expect": {
        "status": "ok",
        "type": "mail.deleted"
      }
    },
    {
      "name": "sector.search (by text)",
      "cmd": "sector.search",
      "data": {
        "q": "Federation"
      },
      "expect": {
        "status": "ok",
        "type": "sector.search_results_v1",
        "data": {
          "items": "*array"
        }
      }
    }
  ]
}
