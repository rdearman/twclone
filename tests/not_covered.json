{
  "tests": [
    {
      "name": "bootstrap.login",
      "cmd": "auth.login",
      "data": {
        "user_name": "newguy",
        "password": "pass123"
      },
      "expect": {
        "status": "ok",
        "type": "auth.session"
      },
      "capture": {
        "me.id": "data.player.id",
        "me.name": "data.player.name"
      }
    },
    {
      "name": "bootstrap.my_ship_and_sector",
      "cmd": "player.my_info",
      "expect": {
        "status": "ok",
        "type": "player.info",
        "data": {
          "player": "*",
          "ship": "*"
        }
      },
      "capture": {
        "curSector": "data.ship.location.sector_id",
        "myShipId": "data.ship.id"
      }
    },
    {
      "name": "bootstrap.find_stardock",
      "cmd": "sector.search",
      "data": {
        "q": "Stardock"
      },
      "expect": {
        "status": "ok",
        "type": "sector.search_results_v1",
        "data": {
          "items": "*array"
        }
      },
      "capture": {
        "stardockSector": "data.items.0.sector_id"
      }
    },
    {
      "name": "bootstrap.move_to_stardock (if not already)",
      "cmd": "move.warp",
      "data": {
        "from_sector_id": "@curSector",
        "to_sector_id": "@stardockSector"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "stardock.bank.balance (ok @ Stardock)",
      "cmd": "bank.balance",
      "expect": {
        "status": "ok",
        "type": "bank.balance_v1",
        "data": {
          "credits": "*"
        }
      }
    },
    {
      "name": "stardock.bank.deposit (ok)",
      "cmd": "bank.deposit",
      "idempotency_key": "key-1762448419-8485",
      "data": {
        "amount": 10
      },
      "expect": {
        "status": "ok",
        "type": "bank.deposited",
        "data": {
          "new_balance": "*"
        }
      }
    },
    {
      "name": "stardock.bank.withdraw (ok)",
      "cmd": "bank.withdraw",
      "idempotency_key": "key-1762448419-1858",
      "data": {
        "amount": 5
      },
      "expect": {
        "status": "ok",
        "type": "bank.withdrawn",
        "data": {
          "new_balance": "*"
        }
      }
    },
    {
      "name": "leave_stardock_for_refusals (to sector 2 if reachable)",
      "cmd": "move.warp",
      "data": {
        "from_sector_id": "@stardockSector",
        "to_sector_id": 2
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      },
      "capture": {
        "curSector2": "data.ship.location.sector_id"
      }
    },
    {
      "name": "bank.deposit refused outside Stardock",
      "cmd": "bank.deposit",
      "data": {
        "amount": 1
      },
      "expect": {
        "status": "refused",
        "type": "error",
        "error": {
          "code": "*"
        }
      }
    },
    {
      "name": "stardock.shipyard.list (ok at Stardock)",
      "cmd": "shipyard.list",
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "stardock.ship.upgrade (holds, insufficient credits handled)",
      "cmd": "ship.upgrade",
      "idempotency_key": "key-1762448419-1482",
      "data": {
        "ship_id": "@myShipId",
        "upgrade": "holds",
        "levels": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "stardock.bar.gamble (envelope exists)",
      "cmd": "bar.gamble",
      "data": {
        "stake": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "stardock.police.hq.query (exists)",
      "cmd": "police.hq",
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "port.search (find a normal trade port)",
      "cmd": "port.search",
      "data": {
        "q": "Port"
      },
      "expect": {
        "status": "ok",
        "type": "port.search_results_v1",
        "data": {
          "items": "*array"
        }
      },
      "capture": {
        "portId": "data.items.0.id",
        "portSector": "data.items.0.sector_id"
      }
    },
    {
      "name": "move.to_port_sector",
      "cmd": "move.warp",
      "data": {
        "from_sector_id": "@curSector2",
        "to_sector_id": "@portSector"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "trade.quote (class-aware quote)",
      "cmd": "trade.quote",
      "data": {
        "port_id": "@portId",
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "ok",
        "type": "*",
        "data": {
          "price_each": "*"
        }
      }
    },
    {
      "name": "trade.buy (ok or refused no holds/credits)",
      "cmd": "trade.buy",
      "idempotency_key": "key-1762448419-1869",
      "data": {
        "port_id": "@portId",
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "trade.sell (ok or refused no stock)",
      "cmd": "trade.sell",
      "idempotency_key": "key-1762448419-9701",
      "data": {
        "port_id": "@portId",
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "planet.create (for tests)",
      "cmd": "planet.create",
      "data": {
        "name": "Testonia"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      },
      "capture": {
        "planetId": "data.planet.id"
      }
    },
    {
      "name": "planet.land (ok)",
      "cmd": "planet.land",
      "data": {
        "planet_id": "@planetId"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "planet.products.list",
      "cmd": "planet.products.list",
      "data": {
        "planet_id": "@planetId"
      },
      "expect": {
        "status": "ok",
        "type": "*",
        "data": {
          "items": "*array"
        }
      }
    },
    {
      "name": "citadel.upgrade (stub)",
      "cmd": "citadel.upgrade",
      "data": {
        "planet_id": "@planetId",
        "level": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "fedspace.refuse.combat (in safe sector)",
      "cmd": "combat.attack",
      "data": {
        "target_player_id": "@me.id"
      },
      "expect": {
        "status": "refused",
        "error": {
          "code": "*"
        }
      }
    },
    {
      "name": "fedspace.refuse.jettison",
      "cmd": "ship.jettison",
      "data": {
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "refused",
        "error": {
          "code": "*"
        }
      }
    },
    {
      "name": "move.pathfind (simple)",
      "cmd": "move.pathfind",
      "data": {
        "from_sector_id": "@portSector",
        "to_sector_id": 1
      },
      "expect": {
        "status": "ok",
        "type": "move.path_v1",
        "data": {
          "steps": "*array"
        }
      }
    },
    {
      "name": "move.autopilot.start (server-side)",
      "cmd": "move.autopilot.start",
      "data": {
        "to_sector_id": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "device.transwarp (gated by hardware/credits)",
      "cmd": "move.transwarp",
      "data": {
        "to_sector_id": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "sector.info includes.npc_placeholder",
      "cmd": "sector.info",
      "data": {
        "sector_id": "@portSector"
      },
      "expect": {
        "status": "ok",
        "type": "sector.info",
        "data": {
          "npcs": "*"
        }
      }
    },
    {
      "name": "notes.set",
      "cmd": "notes.set",
      "data": {
        "scope": "sector",
        "scope_id": "@portSector",
        "text": "Remember to trade ore"
      },
      "expect": {
        "status": "ok",
        "type": "notes.saved"
      }
    },
    {
      "name": "notes.list",
      "cmd": "notes.list",
      "data": {
        "scope": "sector",
        "scope_id": "@portSector"
      },
      "expect": {
        "status": "ok",
        "type": "notes.list_v1",
        "data": {
          "items": "*array"
        }
      }
    },
    {
      "name": "bookmark.add",
      "cmd": "bookmark.add",
      "data": {
        "entity": "sector",
        "id": "@portSector"
      },
      "expect": {
        "status": "ok",
        "type": "bookmark.saved"
      }
    },
    {
      "name": "avoid.add",
      "cmd": "avoid.add",
      "data": {
        "sector_id": "@portSector"
      },
      "expect": {
        "status": "ok",
        "type": "avoid.saved"
      }
    },
    {
      "name": "subscription.add (port price alerts)",
      "cmd": "subscription.add",
      "data": {
        "topic": "port.@portId.ore.price",
        "op": ">=",
        "value": 50
      },
      "expect": {
        "status": "ok",
        "type": "subscription.saved"
      }
    },
    {
      "name": "prefs.set locale",
      "cmd": "prefs.set",
      "data": {
        "key": "ui.locale",
        "value": "en_GB"
      },
      "expect": {
        "status": "ok",
        "type": "prefs.saved"
      }
    },
    {
      "name": "player.get_settings (hydration roundtrip)",
      "cmd": "player.get_settings",
      "expect": {
        "status": "ok",
        "type": "*",
        "data": {
          "prefs": "*",
          "bookmarks": "*",
          "avoid": "*",
          "notes": "*",
          "subscriptions": "*"
        }
      }
    },
    {
      "name": "chat.global.send (cap/truncation tolerated)",
      "cmd": "chat.global.send",
      "data": {
        "message": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      },
      "expect": {
        "status": "*any",
        "type": "*any",
        "meta": "*any"
      }
    },
    {
      "name": "chat.sector.send",
      "cmd": "chat.sector.send",
      "data": {
        "sector_id": "@portSector",
        "message": "Hello sector"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "port.info before.extern",
      "cmd": "port.info",
      "data": {
        "port_id": "@portId"
      },
      "expect": {
        "status": "ok",
        "type": "*",
        "data": {
          "stock": "*"
        }
      }
    },
    {
      "name": "sysop.cron.tick (extern)",
      "cmd": "sysop.cron.tick",
      "data": {
        "job": "extern.restock"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "port.info after.extern (drift expected)",
      "cmd": "port.info",
      "data": {
        "port_id": "@portId"
      },
      "expect": {
        "status": "ok",
        "type": "*",
        "data": {
          "stock": "*"
        }
      }
    },
    {
      "name": "trade.buy overflow/atomicity",
      "cmd": "trade.buy",
      "idempotency_key": "key-1762448419-2285",
      "data": {
        "port_id": "@portId",
        "commodity": "ore",
        "quantity": 999999
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "deploy.fighters.add DEFEND",
      "cmd": "deploy.fighters.add",
      "idempotency_key": "key-1762448419-7942",
      "data": {
        "mode": "DEFEND",
        "amount": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "deploy.fighters.list (ownership filtering)",
      "cmd": "deploy.fighters.list",
      "data": {
        "sector_id": "@portSector"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "deploy.mines.add armid",
      "cmd": "deploy.mines.add",
      "idempotency_key": "key-1762448419-5016",
      "data": {
        "type": "armid",
        "amount": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "deploy.mines.list (by type)",
      "cmd": "deploy.mines.list",
      "data": {
        "sector_id": "@portSector",
        "type": "armid"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "deploy.mines.disarm (own assets)",
      "cmd": "deploy.mines.disarm",
      "data": {
        "sector_id": "@portSector",
        "type": "armid",
        "amount": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "ship.jettison refused.in.safe_zone",
      "cmd": "ship.jettison",
      "data": {
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "refused",
        "error": {
          "code": "*"
        }
      }
    },
    {
      "name": "move.intercept refused.invalid_target",
      "cmd": "move.intercept",
      "data": {
        "target_player_id": "@me.id"
      },
      "expect": {
        "status": "refused",
        "error": {
          "code": "*"
        }
      }
    },
    {
      "name": "system.describe_schema (present)",
      "cmd": "system.describe_schema",
      "data": {
        "namespace": "prompt"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "i18n.catalog_manifest (present)",
      "cmd": "i18n.catalog_manifest",
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "client.hello (echo schema+catalog hashes if supported)",
      "cmd": "client.hello",
      "data": {
        "schemas": "*",
        "i18n": "*"
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "discipline.trade.buy missing fields -> error",
      "cmd": "trade.buy",
      "data": {
        "quantity": 1
      },
      "expect": {
        "status": "error",
        "type": "*any"
      }
    },
    {
      "name": "discipline.move.warp to current sector -> refused",
      "cmd": "move.warp",
      "data": {
        "from_sector_id": "@portSector",
        "to_sector_id": "@portSector"
      },
      "expect": {
        "status": "refused",
        "type": "*any"
      }
    },
    {
      "name": "notice.list paginated (page 1)",
      "cmd": "notice.list",
      "data": {
        "limit": 2
      },
      "expect": {
        "status": "ok",
        "type": "notice.list_v1",
        "data": {
          "items": "*array"
        },
        "meta": {
          "rate_limit": "*",
          "next_cursor": "*any"
        }
      }
    },
    {
      "name": "notice.list paginated (page 2)",
      "cmd": "notice.list",
      "data": {
        "limit": 2,
        "cursor": "@prev.meta.next_cursor"
      },
      "expect": {
        "status": "ok",
        "type": "notice.list_v1",
        "data": {
          "items": "*array"
        }
      }
    },
    {
      "name": "idempotency.trade.buy same key",
      "cmd": "trade.buy",
      "idempotency_key": "fixed-idem-key-demo",
      "data": {
        "port_id": "@portId",
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "idempotency.trade.buy same key (replay)",
      "cmd": "trade.buy",
      "idempotency_key": "fixed-idem-key-demo",
      "data": {
        "port_id": "@portId",
        "commodity": "ore",
        "quantity": 1
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "s2s.heartbeat (envelope)",
      "cmd": "s2s.replication.heartbeat",
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "s2s.event.relay (envelope)",
      "cmd": "s2s.event.relay",
      "data": {
        "event": {
          "type": "test",
          "payload": {
            "x": 1
          }
        }
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "sysop.cron.toggle (dry-run)",
      "cmd": "sysop.cron.toggle",
      "data": {
        "job": "extern.restock",
        "dry_run": true
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    },
    {
      "name": "sysop.backfill.player_defaults (dry-run)",
      "cmd": "sysop.backfill.player_defaults",
      "data": {
        "dry_run": true
      },
      "expect": {
        "status": "*any",
        "type": "*any"
      }
    }
  ]
}